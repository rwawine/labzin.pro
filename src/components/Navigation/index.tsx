"use client";

import Link from 'next/link';
import { useState, useEffect } from 'react';
import styles from './Navigation.module.css';
import Modal from '../Modal';

const Navigation = () => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isMobile, setIsMobile] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);

  useEffect(() => {
    const checkScreenSize = () => {
      setIsMobile(window.innerWidth < 1440);
      if (window.innerWidth >= 1440) {
        setIsMenuOpen(false);
      }
    };

    checkScreenSize();
    window.addEventListener('resize', checkScreenSize);
    return () => window.removeEventListener('resize', checkScreenSize);
  }, []);

  // Handle scroll locking when menu is open
  useEffect(() => {
    if (isMenuOpen || isModalOpen) {
      // Store current scroll position
      const scrollY = window.scrollY;

      // Add styles to prevent scrolling
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.width = '100%';

      return () => {
        // Restore scrolling when component unmounts or menu closes
        document.body.style.position = '';
        document.body.style.top = '';
        document.body.style.width = '';
        window.scrollTo(0, scrollY);
      };
    }
  }, [isMenuOpen, isModalOpen]);

  const toggleMenu = () => {
    setIsMenuOpen(!isMenuOpen);
  };

  const closeMenu = () => {
    setIsMenuOpen(false);
  };

  const openModal = () => {
    setIsModalOpen(true);
    closeMenu();
  };

  const closeModal = () => {
    setIsModalOpen(false);
  };

  return (
    <>
      <nav className={styles.nav}>
        <div className={styles.container}>
          <Link href="/" className={styles.logo}>
            <svg width="100" height="44" viewBox="0 0 100 44" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M29.2759 37.0979C36.7935 37.0979 42.8877 30.9631 42.8877 23.3954C42.8877 15.8277 36.7935 9.69287 29.2759 9.69287C21.7583 9.69287 15.6641 15.8277 15.6641 23.3954C15.6641 30.9631 21.7583 37.0979 29.2759 37.0979Z" fill="#FFC533" />
              <path d="M16.7314 27.995L17.072 27.8408C17.072 27.8408 18.6476 30.6469 19.2535 30.9519L18.7511 31.5068L17.7107 29.9049L16.7314 27.995Z" fill="#FFC533" />
              <path d="M30.5929 34.2554L30.502 36.4972L31.82 36.2227L32.0472 34.2096L30.5929 34.2554Z" fill="#FFC533" />
              <path d="M29.6162 12.7734C29.6162 12.7734 30.5252 16.5555 34.9488 15.3965L34.8882 28.9389C34.8882 28.9389 34.0398 29.2439 33.4945 29.3049V30.5859C33.4945 30.5859 32.8885 34.612 32.5249 35.4661C32.5249 35.4661 31.9492 35.9846 31.8886 36.1676C31.828 36.3506 31.2523 38.8516 31.2523 38.8516V16.3116L13.376 37.0521L14.3455 34.6731C14.3455 34.6731 13.9214 34.2461 14.1031 33.8801C14.2849 33.5141 14.8303 32.05 15.1333 31.623C15.4363 31.196 17.3754 28.8169 17.3754 28.8169L17.1936 27.4749L29.6162 12.7735L29.6162 12.7734Z" fill="black" />
              <path d="M29.1492 14.5217L17.999 27.5149L18.3279 27.8009L29.4781 14.8077L29.1492 14.5217Z" fill="#FFC533" />
              <path d="M34.2568 16.3115H33.8223V28.3899H34.2568V16.3115Z" fill="#FFC533" />
              <path d="M33.2524 14.8475C34.8254 14.8475 36.1005 13.5638 36.1005 11.9804C36.1005 10.3969 34.8254 9.11328 33.2524 9.11328C31.6794 9.11328 30.4043 10.3969 30.4043 11.9804C30.4043 13.5638 31.6794 14.8475 33.2524 14.8475Z" fill="#FFC533" />
              <path d="M33.2525 15.1209C31.5323 15.1209 30.1328 13.7121 30.1328 11.9805C30.1328 10.2488 31.5323 8.83997 33.2525 8.83997C34.9727 8.83997 36.3722 10.2488 36.3722 11.9805C36.3722 13.7121 34.9727 15.1209 33.2525 15.1209ZM33.2525 9.38678C31.8318 9.38678 30.676 10.5503 30.676 11.9805C30.676 13.4107 31.8318 14.5741 33.2525 14.5741C34.6733 14.5741 35.829 13.4106 35.829 11.9805C35.829 10.5503 34.6733 9.38678 33.2525 9.38678Z" fill="black" />
              <path d="M33.4631 8.44226H32.9199V14.8475H33.4631V8.44226Z" fill="black" />
              <path d="M33.9789 5.14819H32.3428V8.13727H33.9789V5.14819Z" fill="black" />
              <path d="M15.3145 31.5009C15.9503 31.5009 16.4658 30.982 16.4658 30.3419C16.4658 29.7018 15.9503 29.1829 15.3145 29.1829C14.6786 29.1829 14.1631 29.7018 14.1631 30.3419C14.1631 30.982 14.6786 31.5009 15.3145 31.5009Z" fill="#FFC533" />
              <path d="M15.3149 31.7197C14.5603 31.7197 13.9463 31.1016 13.9463 30.3418C13.9463 29.5821 14.5603 28.9641 15.3149 28.9641C16.0696 28.9641 16.6835 29.5822 16.6835 30.3418C16.6835 31.1015 16.0696 31.7197 15.3149 31.7197ZM15.3149 29.4016C14.7998 29.4016 14.3809 29.8234 14.3809 30.3418C14.3809 30.8603 14.7998 31.2822 15.3149 31.2822C15.83 31.2822 16.2489 30.8604 16.2489 30.3418C16.2489 29.8233 15.83 29.4016 15.3149 29.4016Z" fill="black" />
              <path d="M34.0703 32.965C34.6894 32.965 35.1914 32.4597 35.1914 31.8364C35.1914 31.2131 34.6894 30.7079 34.0703 30.7079C33.4511 30.7079 32.9492 31.2131 32.9492 31.8364C32.9492 32.4597 33.4511 32.965 34.0703 32.965Z" fill="#FFC533" />
              <path d="M34.0698 33.1837C33.3318 33.1837 32.7314 32.5793 32.7314 31.8364C32.7314 31.0935 33.3318 30.4891 34.0698 30.4891C34.8078 30.4891 35.4081 31.0935 35.4081 31.8364C35.4081 32.5793 34.8077 33.1837 34.0698 33.1837ZM34.0698 30.9266C33.5715 30.9266 33.166 31.3348 33.166 31.8364C33.166 32.3381 33.5715 32.7462 34.0698 32.7462C34.5682 32.7462 34.9735 32.3381 34.9735 31.8364C34.9735 31.3348 34.5681 30.9266 34.0698 30.9266Z" fill="black" />
              <path d="M22.3449 27.8713C22.3449 27.8713 24.89 30.6927 30.465 31.3789V33.3615C30.465 33.3615 25.5263 33.4377 20.9814 29.3964L22.3449 27.8713Z" fill="black" />
              <path d="M46.0209 16.4663H49.6409V18.3835H43.9678V8.86523H46.0209V16.4663Z" fill="black" />
              <path d="M56.705 11.0271H58.1772V18.3699H56.6239L56.4618 17.7172C55.7953 18.2974 55.0074 18.5874 54.098 18.5874C52.9992 18.5874 52.0875 18.2181 51.3627 17.4792C50.6378 16.7405 50.2754 15.8135 50.2754 14.6985C50.2754 13.5926 50.6378 12.6725 51.3627 11.9382C52.0875 11.204 52.9993 10.8368 54.098 10.8368C55.0253 10.8368 55.8223 11.1359 56.4889 11.7342L56.705 11.0271V11.0271ZM52.835 16.1398C53.2086 16.5206 53.6813 16.7109 54.2533 16.7109C54.8253 16.7109 55.3001 16.5206 55.6784 16.1398C56.0566 15.7591 56.2456 15.2787 56.2456 14.6985C56.2456 14.1184 56.0566 13.6379 55.6784 13.2571C55.3001 12.8765 54.8274 12.686 54.2601 12.686C53.8819 12.686 53.5419 12.7745 53.2403 12.9512C52.9384 13.128 52.7021 13.3683 52.5312 13.6718C52.3599 13.9757 52.2745 14.3177 52.2745 14.6985C52.2745 15.2787 52.4613 15.7591 52.835 16.1398Z" fill="black" />
              <path d="M64.0396 10.8369C65.1472 10.8369 66.0634 11.204 66.7883 11.9383C67.5131 12.6725 67.8757 13.5971 67.8757 14.7121C67.8757 15.8271 67.5131 16.7517 66.7883 17.486C66.0634 18.2202 65.1472 18.5874 64.0396 18.5874C63.166 18.5874 62.4051 18.3154 61.7568 17.7716L61.5272 18.3835H60.0684V8.38928H62.0405V11.4351C62.6257 11.0363 63.2921 10.8369 64.0396 10.8369ZM62.4592 16.1399C62.8375 16.5206 63.3122 16.7109 63.8842 16.7109C64.4562 16.7109 64.9287 16.5206 65.3026 16.1399C65.6761 15.7591 65.8631 15.2832 65.8631 14.7121C65.8631 14.3314 65.7797 13.9871 65.6132 13.6787C65.4465 13.3707 65.2101 13.1304 64.9041 12.958C64.5978 12.786 64.2579 12.6997 63.8842 12.6997C63.5105 12.6997 63.1705 12.7859 62.8644 12.958C62.5582 13.1304 62.3195 13.3707 62.1486 13.6787C61.9774 13.9871 61.8919 14.3314 61.8919 14.7121C61.8919 15.2832 62.081 15.7591 62.4592 16.1399Z" fill="black" />
              <path d="M71.4552 16.5614H74.5214V18.3834H68.4971V18.1659L71.6038 12.8357H68.7942V11.0408H74.5214V11.3128L71.4552 16.5614Z" fill="black" />
              <path d="M75.9131 10.0618V8.21252H77.8852V10.0618H75.9131ZM75.9131 18.3835V11.0408H77.8852V18.3835H75.9131Z" fill="black" />
              <path d="M83.9357 10.864C84.7641 10.864 85.4192 11.1428 85.901 11.7003C86.3827 12.2578 86.6237 13.0035 86.6237 13.9371V18.3835H84.6516V14.2498C84.6516 13.1531 84.2282 12.6045 83.3819 12.6045C83.0486 12.6045 82.7583 12.6816 82.5106 12.8357C82.2629 12.9899 82.0737 13.212 81.9433 13.502C81.8127 13.7921 81.7475 14.1321 81.7475 14.5218V18.3835H79.7754V11.0408H81.1262L81.5179 11.9518C81.653 11.7798 81.8083 11.6278 81.9839 11.4963C82.1595 11.365 82.3507 11.2516 82.558 11.1564C82.765 11.0612 82.9834 10.9887 83.2131 10.9388C83.4427 10.8891 83.6835 10.8641 83.9357 10.8641L83.9357 10.864Z" fill="black" />
              <path d="M50.8565 20.1714C52.47 20.1714 53.8173 20.6965 54.8984 21.746C55.9791 22.7958 56.5196 24.1136 56.5196 25.6998C56.5196 27.286 55.9791 28.6042 54.8984 29.6537C53.8173 30.7036 52.47 31.2283 50.8565 31.2283H48.1848V36.2625H44.7139V20.1714H50.8564H50.8565ZM50.7195 28.01C51.4046 28.01 51.9562 27.7957 52.375 27.3664C52.7935 26.9375 53.003 26.3859 53.003 25.7113C53.003 25.0367 52.7935 24.4815 52.375 24.0448C51.9562 23.6079 51.4046 23.3896 50.7195 23.3896H48.1848V28.01H50.7195Z" fill="black" />
              <path d="M64.992 23.7804H66.0881V26.9526H64.6495C63.7054 26.9526 63.0317 27.1749 62.6286 27.6192C62.225 28.0639 62.0234 28.7916 62.0234 29.8031V36.2625H58.6895V23.8493H60.836L61.4297 25.3665C62.2668 24.3091 63.4542 23.7804 64.9921 23.7804H64.992Z" fill="black" />
              <path d="M73.5781 36.6072C72.3142 36.6072 71.1726 36.3236 70.1528 35.7568C69.1327 35.19 68.3374 34.4045 67.7665 33.4005C67.1957 32.397 66.9102 31.2821 66.9102 30.0559C66.9102 28.171 67.5418 26.6078 68.8054 25.3665C70.0689 24.1252 71.6599 23.5045 73.578 23.5045C75.4808 23.5045 77.064 24.1251 78.3278 25.3665C79.5912 26.6078 80.223 28.1709 80.223 30.0559C80.223 31.9258 79.5872 33.485 78.3163 34.7338C77.0451 35.9831 75.4655 36.6072 73.578 36.6072H73.5781ZM73.5781 33.4581C74.5372 33.4581 75.3211 33.1401 75.9301 32.504C76.5387 31.8683 76.8434 31.0523 76.8434 30.0559C76.8434 29.0595 76.5387 28.2439 75.9301 27.6078C75.3211 26.972 74.5332 26.6538 73.5667 26.6538C72.6001 26.6538 71.8119 26.972 71.2032 27.6078C70.5941 28.2439 70.2898 29.0599 70.2898 30.0559C70.2898 30.5465 70.3697 31.0063 70.5296 31.4351C70.6893 31.8644 70.9139 32.2246 71.2032 32.5155C71.4922 32.8068 71.8386 33.0367 72.2422 33.2051C72.6453 33.374 73.0906 33.458 73.578 33.458L73.5781 33.4581Z" fill="black" />
            </svg>
          </Link>

          <button
            className={`${styles.menuButton} ${isMenuOpen ? styles.active : ''}`}
            onClick={toggleMenu}
            aria-label="Меню"
          >
            {isMenuOpen ? (
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.6585 4.92888C18.049 4.53836 18.6822 4.53835 19.0727 4.92888C19.4632 5.3194 19.4632 5.95257 19.0727 6.34309L13.4158 12L19.0727 17.6568C19.4632 18.0473 19.4632 18.6805 19.0727 19.071C18.6822 19.4615 18.049 19.4615 17.6585 19.071L12.0016 13.4142L6.34481 19.071C6.3387 19.0771 6.33254 19.0831 6.32632 19.089C5.93455 19.4614 5.31501 19.4554 4.93059 19.071C4.6377 18.7781 4.56447 18.3487 4.71092 17.9876C4.75973 17.8672 4.83296 17.7544 4.93059 17.6568L10.5874 12L4.93059 6.34314C4.54006 5.95262 4.54006 5.31945 4.93059 4.92893C5.32111 4.5384 5.95428 4.5384 6.3448 4.92893L12.0016 10.5857L17.6585 4.92888Z" fill="black" />
              </svg>
            ) : (
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 7C3 6.44772 3.44772 6 4 6H20C20.5523 6 21 6.44772 21 7C21 7.55229 20.5523 8 20 8H4C3.44772 8 3 7.55229 3 7Z" fill="black" />
                <path d="M4 11C3.44772 11 3 11.4477 3 12C3 12.5522 3.44772 13 4 13H20C20.5523 13 21 12.5522 21 12C21 11.4477 20.5523 11 20 11H4Z" fill="black" />
                <path d="M3 17C3 16.4477 3.44772 16 4 16H20C20.5523 16 21 16.4477 21 17C21 17.5523 20.5523 18 20 18H4C3.44772 18 3 17.5523 3 17Z" fill="black" />
              </svg>
            )}
          </button>

          {/* Background overlay */}
          {isMenuOpen && (
            <div
              className={styles.overlay}
              onClick={closeMenu}
              aria-hidden="true"
            />
          )}

          <ul className={`${styles.links} ${isMenuOpen ? styles.open : ''}`}>
            <li
              className={styles.designMenuItem}
            >
              <div className={styles.designMenuContainer}>
                <button
                  className={styles.linkButton}
                >
                  Проектирование
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <g id="Frame">
                      <path id="Vector" d="M5.85355 6.64647L8.4798 9.27266L11.106 6.64647C11.3013 6.45118 11.6179 6.45118 11.8131 6.64647C12.0084 6.84173 12.0084 7.15827 11.8131 7.35353L8.83334 10.3333C8.73954 10.4271 8.6124 10.4798 8.4798 10.4798C8.3472 10.4798 8.22001 10.4271 8.12621 10.3333L5.14645 7.35353C4.95118 7.15827 4.95118 6.84173 5.14645 6.64647C5.34171 6.45118 5.65829 6.45118 5.85355 6.64647Z" fill="#0D0E14" />
                    </g>
                  </svg>
                </button>
              </div>
            </li>
            <li>
              <Link href="/certificates" className={styles.link} onClick={closeMenu}>
                Сертификаты
              </Link>
            </li>
            <li>
              <Link href="/portfolio" className={styles.link} onClick={closeMenu}>
                Портфолио
              </Link>
            </li>
            <li>
              <Link href="/cooperation" className={styles.link} onClick={closeMenu}>
                Сотрудничество
              </Link>
            </li>
            <li>
              <Link href="/useful" className={styles.link} onClick={closeMenu}>
                Полезная информация
              </Link>
            </li>
            <li>
              <Link href="/about" className={styles.link} onClick={closeMenu}>
                О компании
              </Link>
            </li>
            <li>
              <Link href="/blog" className={styles.link} onClick={closeMenu}>
                Блог
              </Link>
            </li>
            <button className={styles.buttonProject} onClick={openModal}>
              Обсудить проект
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.0009 15.5858L13.5867 12L10.0009 8.41426C9.95209 8.36544 9.90937 8.31284 9.87276 8.25739C9.61648 7.86924 9.65919 7.34176 10.0009 7.00005C10.3914 6.60952 11.0246 6.60952 11.4151 7.00005L15.708 11.2929C15.8955 11.4805 16.0009 11.7348 16.0009 12C16.0009 12.2653 15.8955 12.5196 15.708 12.7072L11.4151 17C11.0246 17.3906 10.3914 17.3906 10.0009 17C9.61038 16.6095 9.61038 15.9764 10.0009 15.5858Z" fill="black" />
              </svg>
            </button>
          </ul>
        </div>
      </nav>

      <Modal isOpen={isModalOpen} onClose={closeModal} />
    </>
  );
};

export default Navigation; 